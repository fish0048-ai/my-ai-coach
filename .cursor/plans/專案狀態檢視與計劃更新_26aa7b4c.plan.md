---
name: 專案狀態檢視與計劃更新
overview: 專案狀態總覽、完成項目索引，並以 3D 虛擬城市比喻敘事功能與資料同步。主要重構與可選項目均已完成。
todos:
  - id: ui-optional
    content: UI 優化：全頁面風格統一 + 人性化設計
    status: completed
  - id: world3d
    content: 3D 虛擬城市世界腳本實作
    status: completed
  - id: kb-1
    content: aiPrompts / workoutGenerator 加入 knowledgeContext
    status: completed
  - id: kb-2
    content: analysisService、nutritionRecommendation、formCorrection 取得 KB 並注入
    status: completed
  - id: followup-test
    content: 後續：完整功能測試（重構後驗證）
    status: pending
  - id: followup-api
    content: 後續：API 相容性檢查（轉接層與現有功能）
    status: pending
isProject: false
---

# 專案狀態檢視與計劃更新

> **最後更新**：2025-01-26  
> **專案狀態**：🟢 主要重構與可選優化均已完成  
> **完整歷程**：[專案狀態檢視與計劃更新_已完成記錄.md](./專案狀態檢視與計劃更新_已完成記錄.md)

---

## 🏙 導言：3D 虛擬城市比喻

My AI Coach 以「**3D 虛擬城市**」比喻系統：使用者化身可操控的小人（Avatar），城市中有多棟主建築對應各功能。走到某棟建築即切換到該功能；建築之間的**光束／管線**表示資料同步。實作上已提供 WorldView（3D 場景與 2D 等角地圖切換），本節以下為敘事與對照，供文件與心智模型對齊。

---

## 📌 執行摘要


| 類別                           | 狀態    |
| ---------------------------- | ----- |
| 階段二：業務邏輯抽離與服務層               | ✅ 已完成 |
| 階段三：大型 View 精簡               | ✅ 已完成 |
| Agentic RAG Phase 1~3        | ✅ 已完成 |
| 知識庫注入（Coach、分析、營養、表單修正）      | ✅ 已完成 |
| UI 優化（Design Token、全頁風格、人性化） | ✅ 已完成 |
| 3D 虛擬城市（WorldView、2D/3D 切換）  | ✅ 已完成 |
| CalendarView 精簡、根層服務目錄調整     | ✅ 已完成 |


---

## 📋 本計劃完成項目（簡述）

### UI 優化 ✅

- **Design Token**：`tailwind.config.js`、`index.css`（色彩、圓角、陰影、字級）
- **Layout**：MainLayout 頁面標題、導航 aria、page-container
- **全頁風格**：card-base、btn-primary/secondary、input-base；Dashboard / Calendar / Nutrition / Gear / CoachChat 等統一
- **人性化**：無障礙標籤、觸控 min 44px、ErrorToast role/aria-live

### 3D 虛擬城市 ✅

- **WorldView**：入口視圖，「3D 場景」/「2D 等角地圖」切換，預設 3D
- **world3dConfig**：建築含行事曆、儀表板、營養、AI 教練、知識庫、趨勢、裝備管理；進入建築即導航或開啟 CoachChat
- **樣式**：2D/3D 畫面套用 Design Token

### 知識庫與 RAG ✅

- aiPrompts、workoutGenerator 取得 knowledgeContext 並傳入 prompt
- analysisService（重訓/跑姿）、nutritionRecommendation、formCorrection、NutritionView 取得 KB 並注入

### 其他可選優化 ✅

- **CalendarView 精簡**：581 行 → 94 行（抽離 useCalendar、CalendarHeader、CalendarGrid）
- **根層服務目錄**：errorService → `services/core/`，backupService → `services/backup/`

---

## 🏠 3D 世界比喻：房子與功能對應


| 建築（房子）   | 對應功能           | 代表檔案／備註                                 |
| -------- | -------------- | --------------------------------------- |
| 行事曆館     | Calendar       | CalendarView、workoutGenerator、匯入／週排程／同步 |
| 訓練儀表板    | Dashboard      | DashboardView、StatsOverview、PRTracker   |
| 營養研究所    | Nutrition      | NutritionView、nutritionRecommendation   |
| AI 教練中心  | CoachChat      | CoachChat、coachService、知識庫與 Context 摘要  |
| 個人知識庫圖書館 | Knowledge Base | KnowledgeBaseView、knowledgeBaseService  |
| 趨勢分析塔    | Trend          | TrendAnalysisView、趨勢與 PR 資料來自行事曆        |
| 裝備管理     | Gear           | GearView、裝備壽命與跑鞋里程                      |


**同步關係（比喻）**：行事曆完成訓練 → 趨勢塔與儀表板更新（光纜發光）；行事曆 → AI 教練中心（教練連線燈亮、Context 同步）；營養紀錄 → 知識庫圖書館（營養卷宗）；知識庫 → AI 教練（RAG 查詢）。

---

## 📐 參考：風格與修改範圍


| 類別           | 對應檔案                                                                                            |
| ------------ | ----------------------------------------------------------------------------------------------- |
| Design Token | tailwind.config.js、src/index.css                                                                |
| Layout       | MainLayout.jsx                                                                                  |
| 核心 View      | DashboardView、CalendarView、NutritionView、KnowledgeBaseView、TrendAnalysisView、GearView、WorldView |
| 共用元件         | StatCard、CoachChat、ErrorToast 等                                                                 |


風格方向：Modern Fitness Dark ＋ Glassmorphism AI Panel。

---

## 📎 技術索引（建築 ↔ 程式）

- 行事曆館 → `src/views/CalendarView.jsx`、`src/hooks/useCalendar.js`、`src/services/ai/workoutGenerator.js`
- 訓練儀表板 → `src/views/DashboardView.jsx`
- AI 教練中心 → `src/components/AICoach/CoachChat.jsx`、`src/services/ai/coachService.js`
- 個人知識庫 → `src/views/KnowledgeBaseView.jsx`、`src/services/ai/knowledgeBaseService.js`
- 3D 世界 → `src/views/WorldView.jsx`、`src/views/World3DView.jsx`、`src/views/World2DView.jsx`、`src/data/world3dConfig.js`

---

## 📌 後續建議（可勾選）


| 項目        | 說明                       | Todo ID         |
| --------- | ------------------------ | --------------- |
| 完整功能測試    | 重構後進行全流程驗證（導航、表單、AI、同步等） | `followup-test` |
| API 相容性檢查 | 確認 API 轉接層與現有呼叫端行為一致     | `followup-api`  |


完成後可將對應 todo 標為 `completed`。

---

## ⚠️ 注意事項

1. **測試覆蓋**：重構後應進行完整功能測試（見上方後續建議）
2. **向後相容**：API 層為轉接層，確保現有功能不受影響
3. **文件**：服務職責與變更見 [已完成記錄](./專案狀態檢視與計劃更新_已完成記錄.md)
4. **Git**：建議每項任務獨立 commit，大型重構使用分支

---

## 📎 相關文件

- [專案狀態檢視與計劃更新_已完成記錄.md](./專案狀態檢視與計劃更新_已完成記錄.md) — 已完成項目清單與 World DSL 規格

