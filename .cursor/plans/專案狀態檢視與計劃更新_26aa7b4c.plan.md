---
name: 專案狀態檢視與計劃更新
overview: 專案狀態總覽、已完成項目索引；新方向為 RPG 遊戲化「Athletica」— 以基地地圖取代 Sidebar、現實數據驅動角色成長與金幣／經驗值。
todos:
  - id: ui-optional
    content: UI 優化：全頁面風格統一 + 人性化設計
    status: completed
  - id: world3d
    content: 3D 虛擬城市世界腳本實作
    status: completed
  - id: kb-1
    content: aiPrompts / workoutGenerator 加入 knowledgeContext
    status: completed
  - id: kb-2
    content: analysisService、nutritionRecommendation、formCorrection 取得 KB 並注入
    status: completed
  - id: followup-test
    content: 後續：完整功能測試（重構後驗證）
    status: completed
  - id: followup-api
    content: 後續：API 相容性檢查（轉接層與現有功能）
    status: completed
  - id: world-art-ux
    content: 3D／2D 虛擬世界：美術與實際應用性提升
    status: completed
  - id: rpg-phase1
    content: RPG 第一階段：地圖導航化（WorldMap 取代 Sidebar、回到地圖按鈕）
    status: completed
  - id: rpg-phase2
    content: RPG 第二階段：RPG 數值（gameProfile、XP/金幣、等級條、Dashboard 顯示）
    status: completed
  - id: rpg-phase3
    content: RPG 第三階段：沉浸感（AI 教練 NPC、營養「鑑定食材」包裝）
    status: completed
  - id: world3d-r3f
    content: 3D 資產升級：React Three Fiber 生態系 + Kenney 3D 素材導入（含風格對齊 Modern Fitness Dark）
    status: completed
  - id: ui-kenney
    content: 整體 UI 大更新：Kenney 平台風格（配色、粗線條、金幣／愛心 HUD、3D 場景配色）
    status: completed
  - id: ui-roadmap
    content: UI 介面修正長中短期目標（依 10 區塊執行）
    status: in_progress
isProject: false
---

# 專案狀態檢視與計劃更新

> **最後更新**：2026-02-06  
> **專案狀態**：🟢 既有重構已完成；📋 新計劃為 **RPG 遊戲化（Athletica）**  
> **完整歷程**：[專案狀態檢視與計劃更新_已完成記錄.md](./專案狀態檢視與計劃更新_已完成記錄.md)

---

## 📌 執行摘要


| 類別                                  | 狀態    |
| ----------------------------------- | ----- |
| 階段二：業務邏輯抽離與服務層                      | ✅ 已完成 |
| 階段三：大型 View 精簡                      | ✅ 已完成 |
| Agentic RAG Phase 1~3、知識庫注入         | ✅ 已完成 |
| UI 優化、3D／2D 虛擬世界美術與應用性              | ✅ 已完成 |
| 3D 資產升級（React Three Fiber + Kenney） | ✅ 已完成 |
| **整體 UI 大更新（Kenney 平台風格）**          | ✅ 已完成 |
| **RPG 第一階段：地圖導航化**                  | ✅ 已完成 |
| **RPG 第二階段：RPG 數值（XP／金幣／等級）**       | ✅ 已完成 |
| **RPG 第三階段：沉浸感（AI NPC、鑑定食材）**       | ✅ 已完成 |


---

## 🎮 新計劃：RPG 遊戲化「Athletica」

### 核心概念：現實驅動的虛擬世界 (Reality-Driven Metaverse)

- **使用者角色**：一位正在修煉的「運動員／勇者」。
- **世界觀**：名為 **Athletica** 的訓練基地。
- **核心迴圈**：現實運動／飲食 → 輸入數據 → 虛擬角色升級／獲得金幣 → 解鎖虛擬裝備／外觀 → 更有動力去現實運動。

**策略**：不打掉重練。現有功能視圖 (Views) 包裝成遊戲場景 (Scenes)；**換皮**（Sidebar → Map）＋**轉譯**（Distance/Pace → XP/Level）。

---

### 一、世界地圖與功能映射 (World Map Mapping)

將導航從 Sidebar 轉為 **2D／2.5D 基地地圖**，點擊建築物進入對應功能頁面。


| 遊戲建築 (Game Building)                | 對應原功能               | 對應程式碼位置                                              | 遊戲化描述                         |
| ----------------------------------- | ------------------- | ---------------------------------------------------- | ----------------------------- |
| **司令部／私人房間 (HQ / My Room)**         | Dashboard           | `src/views/DashboardView.jsx`                        | 角色狀態、疲勞度 (BodyHeatmap)、成就徽章牆。 |
| **競技場／訓練營 (Arena / Training Camp)** | Calendar & Workouts | `src/views/CalendarView.jsx`                         | 訓練任務、提交訓練成果 (Log Workout)。    |
| **補給站／餐廳 (Tavern / Canteen)**       | Nutrition           | `src/views/NutritionView.jsx`                        | 補充體力 (Log Food)、營養分析、食物辨識。    |
| **賢者之塔 (Oracle's Tower)**           | AI Tools / Chat     | `src/components/AICoach/CoachChat.jsx`               | 向 AI 導師請教、生成訓練魔法書 (Plans)。    |
| **科技實驗室 (Tech Lab)**                | Analysis (Form/Run) | `src/views/RunAnalysisView.jsx`、StrengthAnalysisView | 跑姿與動作精密檢測與升級。                 |
| **裝備庫 (Armory)**                    | Gear / Profile      | `src/views/FeatureViews.jsx`、GearView                | 跑鞋耐久度、角色外觀 (Avatar)。          |


*可與現有 `world3dConfig` 建築對齊：司令部↔儀表板、競技場↔行事曆館、補給站↔營養、賢者之塔↔AI 教練、科技實驗室↔趨勢/分析、裝備庫↔裝備。*

---

### 二、系統架構修改 (Architecture Refactor)

在既有 **Service Layer** 之上增加 **遊戲層 (Game Layer)**，不干擾原有業務邏輯。

#### 1. 前端視圖架構

- **App.jsx / MainLayout.jsx**：可選移除傳統 Sidebar，或與地圖並存；**新增 `WorldMap.jsx**` 作為新首頁（Canvas 或 CSS Grid 繪製地圖）。
- **viewStore.js 擴充**：
  - `currentLocation`: `'MAP'` | `BUILDING_ID`
  - `avatarState`: `'IDLE'` | `'RUNNING'` | `'EATING'`（可選，供地圖上 Avatar 表現）

#### 2. 遊戲化邏輯層 (`src/services/game/`)


| 檔案                   | 職責                                                                                          |
| -------------------- | ------------------------------------------------------------------------------------------- |
| **xpSystem.js**      | 監聽 calendarService 寫入；完成 5K 跑 → 50 XP + 10 金幣；達成 PR → 200 XP + 稀有徽章；營養達標 → 體力 (Stamina) 回滿。 |
| **avatarService.js** | 將 PRTracker / BodyHeatmap 數據映射為角色屬性：深蹲→**力量 (STR)**、VO2/跑量→**耐力 (END)**、體脂/體重→**敏捷 (AGI)**。 |


#### 3. 數據層整合

- **userStore / Firebase `users/{uid}**`：新增 `gameProfile` 欄位，例如：
  - `level`, `currentXP`, `nextLevelXP`, `coins`, `equippedSkin`, `attributes: { str, end, agi }`

---

### 三、使用者流程 (User Flow)

- **場景 1 — 登入與基地**：登入後顯示 2.5D 基地地圖；中央為 Avatar；左上角等級、經驗條、金幣；若有「今日待辦訓練」，競技場建築上顯示紅色驚嘆號 `!`。
- **場景 2 — 執行任務**：點擊競技場 → 轉場進入 CalendarView（任務佈告欄風格）→ 完成運動並上傳／手動輸入 → **結算畫面 (Victory Screen)**：由 achievementService 觸發，「任務完成！獲得 100 XP」、破 PR 時「突破極限！力量 +5」→ 離開後 Zoom out 回地圖。
- **場景 3 — 角色養成**：點擊裝備庫 → 用金幣購買虛擬外觀；查看角色屬性雷達圖（由 PRTracker / BodyHeatmap 轉化）。

---

### 四、實作步驟（三階段）


| 階段              | 目標                       | 行動摘要                                                                                                                                                                       |
| --------------- | ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **第一階段：地圖導航化**  | 用地圖取代 Sidebar，不更動內部功能邏輯。 | ① 設計 5–6 張建築圖（SVG 或 Pixel Art）；② 製作 `WorldMap.jsx` 並在 App 使用；③ viewStore 點擊建築 = 切換 `currentView`；④ 各功能頁左上角「回到地圖 (Back to World)」按鈕。                                        |
| **第二階段：RPG 數值** | 將運動數據換算成遊戲幣與經驗值。         | ① 建立 `src/services/game/`（如 gameService.js / xpSystem.js）；② Hook calendarService 的 saveWorkout，儲存成功時計算 XP 並更新 Firebase `users/{uid}/gameProfile`；③ Dashboard（司令部）顯示等級與經驗條。 |
| **第三階段：沉浸感**    | 讓 AI 教練實體化、營養流程遊戲化。      | ① CoachChat 整合進「賢者之塔」，進入時 AI 教練以 NPC 形象對話；② NutritionView 食物辨識包裝成「鑑定食材」儀式。                                                                                                 |


---

### 五、3D 資產升級計劃（React Three Fiber + Kenney 3D）

目標：將目前偏幾何、程式生成的 3D 城市，升級為使用專業 3D 資產的場景，同時導入 React Three Fiber 生態系，讓未來擴充更容易。

**步驟一：安裝 React Three Fiber 生態系**

- 安裝核心套件（暫定）：
  - `three`
  - `@react-three/fiber`
  - `@react-three/drei`
- 規劃調整：
  - 將 `World3DView` 逐步改寫為 `<Canvas>` 場景，由 React Three Fiber 掌控相機、燈光與模型載入。
  - 保留現有 `world3dConfig` 做為「邏輯層／建築 DSL」，僅改變渲染層實作。

**步驟二：導入 Kenney 3D 資產（城市／小鎮）**

- 從 Kenney 官方 3D 資產庫挑選適合 Athletica 的套件，例如：
  - City / Town 系列（如 City Kit、Fantasy Town Kit 等）  
  - 資產來源：[Kenney 3D Assets](https://kenney.nl/assets/category:3D)
- 實作規劃：
  - 下載對應城市／建築模型（建議採用 glTF / glb 格式），放置於 `public/models/kenney` 或類似目錄。
  - 在新的 React Three Fiber 場景中，為「司令部、競技場、補給站、賢者之塔、科技實驗室、裝備庫」各挑選對應外觀，並以 `world3dConfig` 提供的位置參數擺放。
  - 後續可加入簡單動畫（如旗幟、燈光閃爍）與材質調整，維持 Modern Fitness Dark 品牌風格。

此升級計劃可獨立於 RPG 三階段之外進行，完成後再將 `WorldView` 的 3D 模式切換至新的 R3F 實作版本。

**已完成**：Kenney City Kit Industrial GLB 導入、貼圖路徑（Textures/colormap.png）、燈光與材質對齊 Modern Fitness Dark（冷色燈、主色微染、建築材質暗化、漸層疊加與邊框與整站一致）。

---

### 六、整體 UI 大更新（Kenney 平台風格）

依據 **Kenney New Platformer Pack** 與附圖風格，將整站 UI 換成平台遊戲風：明亮飽和、粗線條、金幣／愛心 HUD 感。

**設計參考**：

- **配色**：天空淺藍、草地綠、土地暖棕、水藍、區塊黃／紅／藍等飽和色；UI 白底＋淺藍描邊、愛心紅、金幣黃。
- **視覺**：粗深色描邊（outline）、圓潤按鈕與卡片、HUD 式金幣／體力顯示。
- **資源**：`kenney/kenney_new-platformer-pack-1.1`（Sprites/Tiles/Double：coin_gold.png、heart.png、block 等；Vector：background_solid_sky.svg、background_solid_grass.svg 等）。

**實作範圍**：

1. **Design Token**：新增 game-sky、game-grass、game-earth、game-coin、game-heart 等色；按鈕／卡片改為粗邊、圓角、飽和色。
2. **全局**：body 背景、卡片、按鈕、輸入框套用新 token；可選使用 Kenney 金幣／愛心圖示於 WorldMap 或全域 HUD。
3. **3D 場景配色**：燈光與霧色對齊平台風格（天空藍、草地綠感或互補），與 2D／HUD 一致。

**外部資源**：目前僅使用專案內 `kenney/kenney_new-platformer-pack-1.1`；若需更多 Kenney 套件（例如 UI 專用、音效），再另行告知引入方式。

---

### 七、UI 介面修正的長中短期目標

- **短期**：視覺與元件統一（Design Token、card-base / btn-primary / btn-secondary、border-game-outline、game-* 配色）、無障礙小修正（aria、按鈕 min-height）。
- **中期**：動線與資訊架構、表單與錯誤/成功回饋、載入/空狀態一致性。
- **長期**：互動與微動效、進階響應式與可及性、數據視覺化與可讀性優化。

依序針對下列 10 個介面區塊訂定具體目標：

1. **總攬（Dashboard）**
   - **短期**：StatsOverview、PRTracker、AchievementPanel、TodaySchedule、BackupBanner、ShareMenu 已部分統一；補齊 StatCard、GameProfileStrip 與其餘小元件之 game-* / card-base / 按鈕樣式；錯誤邊界與登入畫面維持一致邊框與按鈕。
   - **中期**：Dashboard 區塊優先順序與摺疊/展開；BodyHeatmap 說明與圖例；空狀態（無 PR、無成就）引導文案與 CTA。
   - **長期**：關鍵指標一頁摘要、自訂 Widget 順序或隱藏；數據卡片互動（如點擊展開明細）。

2. **行事曆（Calendar）**
   - **短期**：CalendarHeader、CalendarGrid、ImportSection、WorkoutCard、WorkoutForm、CalendarDayModal、WeeklyModal 全面採用 card-base / btn-* / border-game-outline、game-grass 選取與拖放提示；拖曳說明列使用 hint-bar。
   - **中期**：月/週切換動線、今日高亮與待辦提示；表單驗證與儲存回饋一致；匯入/匯出成功或錯誤提示樣式統一。
   - **長期**：週視圖與日視圖並存或切換；訓練卡片拖曳動效與放置回饋。

3. **營養師（Nutrition）**
   - **短期**：NutritionView 已做部分統一；確認所有按鈕、卡片、輸入框、ProgressBar、智能建議區塊皆為 card-base / input-base / btn-* / game-*；食物列表與刪除按鈕樣式一致。
   - **中期**：熱量/三大營養素目標設定與說明；鑑定結果表單欄位分組與必填提示；智能建議載入與空狀態。
   - **長期**：圖表或趨勢（每日攝取曲線）；與訓練日連動的營養建議文案。

4. **數據趨勢（Trend Analysis）**
   - **短期**：TrendAnalysisView 容器、卡片、按鈕改為 card-base、btn-primary/btn-secondary、border-game-outline；圖表區邊框與標題使用 game-* 或 surface-*；篩選器與日期選擇器樣式統一。
   - **中期**：趨勢維度切換（跑量/配速/力量等）與時間區間；圖例與軸標籤可讀性；空資料說明與 CTA。
   - **長期**：圖表互動（hover 明細、縮放）；匯出報表樣式與平台風格一致。

5. **裝備管理（Gear）**
   - **短期**：GearView 列表與表單使用 card-base、input-base、btn-*；裝備卡片邊框與狀態標籤（如耐久度）使用 game-*；新增/編輯 Modal 與主頁風格一致。
   - **中期**：裝備與訓練/跑步紀錄的關聯展示；耐久度或使用次數的說明與提醒。
   - **長期**：裝備統計或視覺化（如各鞋使用比例）；與遊戲化金幣/外觀的串接（若納入計劃）。

6. **重訓分析（Strength Analysis）**
   - **短期**：StrengthAnalysisView 版面與控制項改為 card-base、btn-*、border-game-outline；圖表與表格容器統一邊框與背景；動作選擇與篩選 UI 一致。
   - **中期**：1RM/訓練量趨勢說明；空狀態與「尚未有數據」引導；表單錯誤與成功回饋。
   - **長期**：動作比對、週期化視圖；圖表互動與匯出。

7. **跑姿分析（Run Analysis）**
   - **短期**：RunAnalysisView 容器、卡片、按鈕與表單統一為 card-base、input-base、btn-*、game-*；分析結果區塊與建議區塊邊框與標題一致。
   - **中期**：分析維度與指標說明；載入中與無資料狀態；錯誤訊息樣式與 ErrorToast 一致。
   - **長期**：跑姿指標與趨勢圖；與訓練計畫或跑步課表的聯動提示。

8. **訓練計畫推薦（Training Plan）**
   - **短期**：TrainingPlanView 列表與卡片、篩選與篩選按鈕、主要 CTA 改為 card-base、btn-*、border-game-outline；計畫卡片標籤與狀態用 game-grass / game-coin 等。
   - **中期**：計畫詳情頁或 Modal 的資訊架構；「套用到行事曆」流程與成功/失敗回饋；空狀態與無符合條件說明。
   - **長期**：計畫與實際完成率對照；推薦邏輯簡要說明（可讀性）。

9. **個人知識庫（Knowledge Base）**
   - **短期**：KnowledgeBaseView 容器、搜尋列、結果列表、新增/編輯表單使用 card-base、input-base、btn-*、game-*；標籤與分類樣式統一。
   - **中期**：搜尋結果排序與篩選；新增條目成功/錯誤回饋；空狀態與引導（如何建立第一筆知識）。
   - **長期**：條目與 AI 引用來源的對應展示；簡單的類別或標籤統計。

10. **個人檔案（Profile / FeatureViews）**
    - **短期**：ProfileHeader、BodyDataForm、TrainingScheduleSection、RunningScheduleSection、SupplementsList、備份與恢復區塊已部分統一；確認所有表單欄位為 input-base、按鈕為 btn-*、區塊為 card-base；分隔線與標題使用 game-outline / game-grass。
    - **中期**：表單分區與進度（如「基本資料 / 訓練習慣 / 跑步課表」）；驗證與儲存回饋一致；備份/還原結果區塊已用 game-*，保持並檢查無遺漏。
    - **長期**：頭像或外觀預覽；與 gameProfile（等級/金幣）的展示整合（若保留於此頁）。

---

## 🏙 既有完成項目（簡述）

以下為已完成的架構與功能，RPG 遊戲化將在此基礎上「換皮＋轉譯」。

### UI 與 3D 虛擬城市 ✅

- Design Token、MainLayout、全頁風格、無障礙；WorldView（3D／2D 切換）、world3dConfig、載入／tooltip／快捷入口／重置視角；霧效與品牌配色。

### 知識庫與 RAG ✅

- aiPrompts、workoutGenerator、analysisService、nutritionRecommendation、formCorrection 取得 KB 並注入。

### 其他 ✅

- CalendarView 精簡、根層服務目錄調整（errorService → core/，backupService → backup/）。

---

## 🏠 建築對照（既有 world3dConfig ↔ 遊戲化名稱）


| 既有建築     | 遊戲化建築        | 對應 View / 功能                      |
| -------- | ------------ | --------------------------------- |
| 行事曆館     | 競技場／訓練營      | CalendarView                      |
| 訓練儀表板    | 司令部／私人房間     | DashboardView                     |
| 營養研究所    | 補給站／餐廳       | NutritionView                     |
| AI 教練中心  | 賢者之塔         | CoachChat                         |
| 個人知識庫圖書館 | （可併入賢者之塔或獨立） | KnowledgeBaseView                 |
| 趨勢分析塔    | 科技實驗室（或合併）   | TrendAnalysisView、RunAnalysisView |
| 裝備管理     | 裝備庫          | GearView、Profile                  |


---

## 📐 參考：風格與修改範圍


| 類別           | 對應檔案                                                                            |
| ------------ | ------------------------------------------------------------------------------- |
| Design Token | tailwind.config.js、src/index.css                                                |
| Layout       | MainLayout.jsx                                                                  |
| 地圖／世界        | WorldView、World3DView、World2DView、world3dConfig.js；**新** WorldMap.jsx（RPG 地圖首頁） |
| 遊戲層          | **新** src/services/game/（xpSystem.js、avatarService.js、gameService.js）           |
| 狀態           | viewStore.js（擴充 currentLocation、avatarState）；userStore / Firebase gameProfile   |


風格方向：**Kenney 平台風格**（明亮飽和、粗線條、金幣／愛心 HUD）；RPG 階段可逐步加入任務佈告欄、結算畫面、NPC 對話框等組件。過往為 Modern Fitness Dark ＋ Glassmorphism，已由整體 UI 大更新切換至平台風。

---

## ⚠️ 注意事項

1. **測試覆蓋**：每階段完成後做功能與回歸測試。
2. **向後相容**：API 與既有 Service 不破壞現有行為；遊戲層僅「訂閱／轉譯」既有數據。
3. **文件**：服務職責與變更見 [已完成記錄](./專案狀態檢視與計劃更新_已完成記錄.md)。
4. **Git**：建議每階段獨立 branch／commit。

---

## 📎 相關文件

- [專案狀態檢視與計劃更新_已完成記錄.md](./專案狀態檢視與計劃更新_已完成記錄.md) — 已完成項目清單與 World DSL 規格  
- 桌面 `cursor.txt` — RPG 遊戲化架構與流程說明（本計劃設計依據）

