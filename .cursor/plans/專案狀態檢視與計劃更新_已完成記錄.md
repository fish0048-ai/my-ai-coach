# å°ˆæ¡ˆè¨ˆåŠƒ - å·²å®Œæˆé …ç›®è¨˜éŒ„

> æœ¬æª”æ¡ˆç‚ºå·²å®Œæˆå…§å®¹çš„èªªæ˜å‚™å­˜ï¼Œä¸»è¨ˆåŠƒæª”åƒ…ä¿ç•™å°šæœªå®Œæˆé …ç›®ã€‚

---

## ğŸ“Š å·²å®Œæˆé …ç›®æ¸…å–®

1. **å·¥å…·åº«çµ±ä¸€** - `utils/date.js`ã€`utils/number.js`ã€`utils/aiJson.js` å·²å»ºç«‹ä¸¦ä½¿ç”¨
2. **API Key ç®¡ç†é·ç§»** - `apiKeyService.js` å’Œ `useApiKey.js` å·²å»ºç«‹
3. **AI æœå‹™å±¤å»ºç«‹** - `workoutGenerator.js`ã€`coachService.js`ã€`analysisService.js` å·²å»ºç«‹
4. **API å±¤éª¨æ¶** - `api/workouts.js`ã€`api/nutrition.js`ã€`api/body.js`ã€`api/gears.js` å·²å»ºç«‹
5. **PR æœå‹™æŠ½é›¢** - `services/workout/prService.js` å·²å»ºç«‹
6. **ä½¿ç”¨è€…æœ¬åœ°ç¡¬ç¢Ÿç˜¦èº«** - å½±ç‰‡ / CSV Blob URL å³æ™‚å›æ”¶
7. **ä»»å‹™ 2-1ï¼šæŠ½é›¢æª”æ¡ˆè§£ææœå‹™** - `fitParser.js`ã€`csvParser.js`ã€`importService` å·²å»ºç«‹
8. **ä»»å‹™ 2-2ï¼šé©—è­‰ AI JSON è§£æçµ±ä¸€ä½¿ç”¨** - å‡ä½¿ç”¨ `parseLLMJson`
9. **ä»»å‹™ 2-3ï¼šå»ºç«‹ MediaPipe åˆ†ææœå‹™** - `poseAnalysis.js`ã€`metricsCalculator.js` å·²å»ºç«‹
10. **ä»»å‹™ 2-4ï¼šå»ºç«‹éŸ¿æ‡‰å¼ Hooks** - `useWorkouts`ã€`useNutrition`ã€`useGears`ã€`workoutStore` å·²å»ºç«‹
11. **ä»»å‹™ 2-5ï¼šé·ç§»è‡³çµ±ä¸€ API å±¤** - Firebase é‚è¼¯ç§»å…¥ `api/workoutsImpl.js`ã€`api/gearsImpl.js`ã€`api/nutritionImpl.js`ã€`api/userImpl.js`ï¼›`calendarService`ã€`nutritionService` æ”¹ç‚ºé€é API å±¤è½‰ç™¼
12. **ä»»å‹™ 3-1ï¼šç²¾ç°¡ CalendarView** - æ–°å¢ `WorkoutCard`ã€`ImportSection`ã€`CalendarDayModal`ã€`getEmptyEditForm`ã€`workoutToEditForm`ï¼›å¾ŒçºŒå†æŠ½é›¢ `useCalendar`ã€`CalendarHeader`ã€`CalendarGrid`ï¼ˆ581â†’94 è¡Œï¼‰
13. **ä»»å‹™ 3-2ï¼šç²¾ç°¡ Strength/Run åˆ†æ View** - æ–°å¢ `ScoreGauge`ã€`MetricsPanel`ã€`StrengthDeviationPanel`
14. **ä»»å‹™ 3-3ï¼šç²¾ç°¡ DashboardView** - æ–°å¢ `ShareMenu`ã€`BackupBanner`ã€`TodaySchedule`ã€`StatsOverview`ã€`RunningStatsSection`ã€`TrainingAdviceSection`
15. **ä»»å‹™ 3-4ï¼šçµ±ä¸€å‘½åèˆ‡çµ„ç¹”** - `apiKeyService`ã€`authService` å·²ç§»è‡³ `services/config/`
16. **Agentic RAG Phase 1~3** - è³‡æ–™åº«é¸å‹ã€ETLã€çµ±è¨ˆ APIã€Tool Schemaã€Gemini Function Callingã€Embedding Pipelineã€é—œéµå­—è§¸ç™¼å‘é‡æœå°‹ã€æ­·å²å°è©±å£“ç¸®
17. **UI å„ªåŒ–** - Design Tokenï¼ˆtailwind.config.jsã€index.cssï¼‰ã€MainLayout å°èˆªèˆ‡é é¢æ¨™é¡Œã€å…¨é é¢ card-base çµ±ä¸€ï¼ˆStatCardã€StatsOverviewã€TodayScheduleã€PRTrackerã€AchievementPanelã€WeatherWidgetã€CoachChat ç­‰ï¼‰ã€äººæ€§åŒ–ç´°ç¯€ï¼ˆç„¡éšœç¤™ ariaã€è§¸æ§ min 44pxã€input-baseã€btn-primary/secondaryï¼‰
18. **ä»»å‹™ 3-4 å‰©é¤˜** - errorService å·²ç§»è‡³ `services/core/errorService.js`ï¼ŒbackupService å·²ç§»è‡³ `services/backup/backupService.js`

---

## ä»»å‹™è©³æƒ…ï¼ˆå·²å®Œæˆï¼‰

### éšæ®µäºŒï¼šæ¥­å‹™é‚è¼¯æŠ½é›¢èˆ‡æœå‹™å±¤å»ºç«‹

- **2-1**ï¼šfitParser.jsã€csvParser.jsã€importService å·²å»ºç«‹
- **2-2**ï¼šAI æœå‹™å‡ä½¿ç”¨ parseLLMJson
- **2-3**ï¼šposeAnalysis.jsã€metricsCalculator.js å·²å»ºç«‹
- **2-4**ï¼šuseWorkoutsã€useNutritionã€useGearsã€workoutStore å·²å»ºç«‹
- **2-5**ï¼šapi/workoutsImplã€gearsImplã€nutritionImplã€userImplï¼›calendarServiceã€nutritionService æ”¹ç”¨ API å±¤

### éšæ®µä¸‰ï¼šå¤§å‹ View ç²¾ç°¡

- **3-1**ï¼šWorkoutCardã€ImportSectionã€CalendarDayModal å·²æŠ½é›¢
- **3-2**ï¼šScoreGaugeã€MetricsPanelã€StrengthDeviationPanel å·²æŠ½é›¢
- **3-3**ï¼šShareMenuã€BackupBannerã€TodayScheduleã€StatsOverviewã€RunningStatsSectionã€TrainingAdviceSection å·²æŠ½é›¢
- **3-4**ï¼šapiKeyServiceã€authService å·²ç§»è‡³ config/ï¼›errorService å·²ç§»è‡³ core/ï¼›backupService å·²ç§»è‡³ backup/

### Agentic RAG Phase 1~3

- **Phase 1**ï¼šbackend/schema.sqlã€backend/etl/ã€backend/stats.py
- **Phase 2**ï¼štool_schema.jsonã€coachPromptsã€runGeminiWithToolsã€coachService Function Calling
- **Phase 3**ï¼šknowledgeBaseService embeddingã€backfillEmbeddingsã€shouldUseVectorSearchã€conversationSummaryService

### UI å„ªåŒ–

- Design Tokenï¼šprimaryã€accentã€dangerã€surface è‰²ç›¤ï¼Œrounded-card/panel/buttonï¼Œshadow-card/glass
- MainLayoutï¼šVIEW_TITLES é é¢æ¨™é¡Œã€å°èˆª aria-labelã€focus-visible ringã€page-container
- å…¨é é¢çµ±ä¸€ï¼šcard-baseã€btn-primary/secondaryã€input-baseã€primary-400/500/600
- äººæ€§åŒ–ï¼šErrorToast role/aria-liveã€CoachChat aria-labelã€è§¸æ§ min 44px

### ä½¿ç”¨è€…æœ¬åœ°ç¡¬ç¢Ÿç˜¦èº«

- å½±ç‰‡ Blob å›æ”¶ï¼šStrengthAnalysisViewã€RunAnalysisView
- CSV åŒ¯å‡º Blob å›æ”¶ï¼šCalendarViewã€TrendAnalysisView

---

## ğŸ™ 3D è™›æ“¬åŸå¸‚è¨­è¨ˆè¦æ ¼ï¼ˆWorld DSLï¼‰

> è¨­è¨ˆè¦æ ¼å·²å®šç¨¿ï¼Œå¯¦ä½œç‚ºæœ€ä½å„ªå…ˆã€‚buildingsã€roomsã€links æè¿°åŠŸèƒ½å°æ‡‰é—œä¿‚ã€‚

```world
avatar: id: player, startRoom: calendar.lobby
buildings: calendar(è¡Œäº‹æ›†é¤¨), dashboard(è¨“ç·´å„€è¡¨æ¿), nutrition(ç‡Ÿé¤Šç ”ç©¶æ‰€), ai_coach(AIæ•™ç·´ä¸­å¿ƒ), knowledge_base(å€‹äººçŸ¥è­˜åº«), trend(è¶¨å‹¢åˆ†æå¡”)
links: calendarâ†’dashboard, calendarâ†’trend, calendarâ†’ai_coach, nutritionâ†’knowledge_base, knowledge_baseâ†’ai_coach
```

å®Œæ•´ World DSL è…³æœ¬è«‹è¦‹åŸå§‹è¨ˆåŠƒæª”æ­·å²ç‰ˆæœ¬ã€‚
