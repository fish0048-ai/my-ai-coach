---
name: 项目优化与新功能建议
overview: 基于当前项目状态，提出架构优化建议和实用的新功能建议，涵盖代码质量提升、用户体验改进和功能扩展。
todos: []
---

# 项目优化与新功能建议

## 一、目前建议如何优化

### 1.1 代码质量优化

#### 1.1.1 完成剩余重构任务

**当前状态**: 已完成大量重构，但仍有部分任务未完成

**需要完成的任务**:

- `CalendarView.jsx` 仍包含 `cleanNumber` 重复定义（第 16-20 行），应移至 `src/utils/number.js`
- `CalendarView.jsx` 仍有 700+ 行，建议继续拆分：
                                                                                                                                - 将 AI 生成逻辑抽离至 `src/services/ai/workoutGenerator.js`
                                                                                                                                - 将文件解析逻辑移至 `src/services/import/` 
                                                                                                                                - 将 `WeeklyModal` 抽离为独立组件 `src/components/Calendar/WeeklyModal.jsx`

**影响文件**:

- `src/views/CalendarView.jsx` - 移除重复函数和复杂逻辑
- `src/utils/number.js` - 新建，统一数值处理函数
- `src/services/ai/workoutGenerator.js` - 新建，封装 AI 课表生成
- `src/components/Calendar/WeeklyModal.jsx` - 新建，拆分模态框组件

**预期收益**: CalendarView 从 700+ 行降至 300-400 行，提高可维护性

---

#### 1.1.2 统一错误处理机制

**当前问题**:

- 错误处理分散在各处，使用 `try-catch` + `alert()` 或 `console.error`
- 没有统一的错误展示界面
- 错误信息对用户不友好

**建议方案**:

- 创建 `src/services/errorService.js` 统一错误处理
- 创建 `src/components/common/ErrorToast.jsx` 统一错误提示组件
- 替换所有 `alert()` 和 `console.error` 为统一的错误服务

**实现要点**:

```javascript
// src/services/errorService.js
export const handleError = (error, context) => {
  // 统一错误日志记录
  // 转换为用户友好的错误消息
  // 触发错误提示 UI
}

// 使用示例
try {
  await someOperation();
} catch (error) {
  handleError(error, { context: 'CalendarView', operation: 'fetchWorkouts' });
}
```

**影响文件**:

- `src/services/errorService.js` - 新建
- `src/components/common/ErrorToast.jsx` - 新建
- 所有 View 组件 - 替换错误处理逻辑

**预期收益**: 统一错误体验，便于错误追踪和调试

---

#### 1.1.3 状态管理优化

**当前问题**:

- 无全局状态管理，跨组件数据同步困难
- `userData` 通过 props 逐层传递
- 状态更新分散在各组件

**建议方案**:

- 引入轻量级状态管理（推荐 `zustand` 或 `jotai`）
- 将 `userData`、`workouts`、`currentView` 等全局状态统一管理
- 创建自定义 Hooks 封装状态访问逻辑

**实现示例**:

```javascript
// src/store/userStore.js (使用 zustand)
import create from 'zustand';

export const useUserStore = create((set) => ({
  userData: null,
  setUserData: (data) => set({ userData: data }),
  // ...
}));

// 使用
const userData = useUserStore(state => state.userData);
```

**影响文件**:

- `src/store/` - 新建状态管理目录
- `src/App.jsx` - 改用状态管理
- 各 View 组件 - 改用状态管理而非 props 传递

**预期收益**: 简化数据流，提高跨组件通信效率

---

#### 1.1.4 类型安全改进

**当前问题**:

- 项目使用 JavaScript，缺少类型检查
- 运行时错误难以提前发现
- 重构时缺少类型提示

**建议方案**:

- 逐步迁移至 TypeScript（可选）
- 或使用 JSDoc 添加类型注解
- 使用 PropTypes 或 TypeScript 检查工具

**短期方案**: 使用 JSDoc 添加类型注解

```javascript
/**
 * @param {Date|string} date - 日期对象或字符串
 * @returns {string} YYYY-MM-DD 格式的日期字符串
 */
export const formatDate = (date) => { /* ... */ };
```

**长期方案**: 逐步迁移至 TypeScript

**预期收益**: 减少运行时错误，提高开发体验

---

### 1.2 性能优化

#### 1.2.1 数据缓存策略

**当前问题**:

- 重复请求相同数据（如 `listCalendarWorkouts`）
- 缺少缓存机制，每次切换页面都重新获取数据

**建议方案**:

- 实现简单的内存缓存（如使用 `Map` 缓存查询结果）
- 在 `calendarService.js` 中添加缓存层
- 使用 React Query 或 SWR 进行数据缓存（可选）

**实现示例**:

```javascript
// src/services/calendarService.js
const cache = new Map();

export const listCalendarWorkouts = async () => {
  const cacheKey = 'calendar_workouts';
  if (cache.has(cacheKey)) {
    return cache.get(cacheKey);
  }
  const data = await fetchWorkouts();
  cache.set(cacheKey, data);
  return data;
};
```

**预期收益**: 减少 Firebase 读取次数，提高页面响应速度

---

#### 1.2.2 代码分割优化

**当前状态**: 已使用 React.lazy，但可以进一步优化

**建议改进**:

- 检查 bundle 大小，识别大型依赖（如 MediaPipe、fit-file-parser）
- 将大型库按需加载
- 使用动态 import 加载 AI 相关功能

**影响文件**:

- `src/App.jsx` - 优化 lazy loading
- `src/views/StrengthAnalysisView.jsx` - 延迟加载 MediaPipe
- `src/views/RunAnalysisView.jsx` - 延迟加载 MediaPipe

**预期收益**: 减少初始加载时间，提高首屏性能

---

### 1.3 用户体验优化

#### 1.3.1 加载状态优化

**当前问题**:

- 加载状态不够明确，用户不知道在加载什么
- 缺少骨架屏（Skeleton Screen）

**建议方案**:

- 为各个页面添加骨架屏组件
- 优化加载提示文案（如"正在加载训练数据..."）
- 使用 Suspense 边界提供更好的加载体验

**影响文件**:

- `src/components/common/Skeleton.jsx` - 新建骨架屏组件
- 各 View 组件 - 添加骨架屏

**预期收益**: 改善加载体验，减少用户等待焦虑

---

#### 1.3.2 表单验证增强

**当前问题**:

- 表单验证逻辑分散在各处
- 验证错误提示不够清晰

**建议方案**:

- 创建统一的表单验证工具 `src/utils/validation.js`
- 添加实时验证反馈
- 改进错误提示 UI

**影响文件**:

- `src/utils/validation.js` - 新建验证工具
- `src/components/Calendar/WorkoutForm.jsx` - 使用验证工具
- `src/components/Profile/BodyDataForm.jsx` - 使用验证工具

**预期收益**: 减少数据错误，提升表单体验

---

## 二、建议新增的功能

### 2.1 数据分析增强

#### 2.1.1 训练周期分析

**功能描述**:

- 分析用户的训练周期（增肌期、减脂期、恢复期）
- 提供周期建议（如建议进入减脂期）
- 可视化展示训练周期变化

**实现要点**:

- 基于训练频率、强度、体脂率等数据计算周期
- 创建 `src/utils/cycleAnalysis.js` 分析逻辑
- 在 `TrendAnalysisView` 中添加周期分析卡片

**预期收益**: 帮助用户科学规划训练周期

---

#### 2.1.2 PR (Personal Record) 追踪

**功能描述**:

- 自动识别并记录各项动作的 PR
- 显示历史 PR 图表
- 鼓励用户突破 PR

**实现要点**:

- 在 `calendarService.js` 中添加 PR 识别逻辑
- 创建 `src/components/Dashboard/PRTracker.jsx` 组件
- 在 Dashboard 显示最新 PR

**预期收益**: 提升训练动力，追踪进步

---

#### 2.1.3 训练计划推荐

**功能描述**:

- 基于用户历史数据和目标，推荐训练计划
- 支持多种计划（如 5x5、Push/Pull/Legs）
- AI 生成个性化计划

**实现要点**:

- 扩展 `src/services/ai/workoutGenerator.js`
- 创建 `src/views/TrainingPlanView.jsx` 新页面
- 集成到 Calendar 页面

**预期收益**: 为新用户提供训练方向

---

### 2.2 社交与分享功能

#### 2.2.1 训练成就系统

**功能描述**:

- 定义训练成就（如"连续训练 7 天"、"总跑量 100km"）
- 成就徽章展示
- 激励用户持续训练

**实现要点**:

- 创建 `src/services/achievementService.js`
- 在 `DashboardView` 添加成就展示区
- 使用 Firebase 存储成就数据

**预期收益**: 增加用户粘性和训练动机

---

#### 2.2.2 训练日志分享

**功能描述**:

- 用户可以分享训练日志（图片、数据）
- 生成训练报告 PDF
- 导出训练数据（JSON/CSV）

**实现要点**:

- 创建 `src/utils/reportGenerator.js` 生成报告
- 添加分享功能（复制链接、生成图片）
- 使用 jsPDF 或类似库生成 PDF

**预期收益**: 满足用户分享需求，增加传播

---

### 2.3 AI 功能增强

#### 2.3.1 智能营养建议

**功能描述**:

- 基于训练强度和时间，推荐饮食
- 分析营养摄入与训练目标的匹配度
- 提供食谱建议

**实现要点**:

- 扩展 `src/services/ai/nutritionService.js`
- 在 `NutritionView` 添加智能建议卡片
- 集成训练数据（今日训练强度）

**预期收益**: 提升营养功能价值

---

#### 2.3.2 动作纠正助手

**功能描述**:

- 实时分析动作视频，提供纠正建议
- 对比标准动作，指出偏差
- 生成纠正训练计划

**实现要点**:

- 增强 MediaPipe 分析功能
- 创建动作对比算法
- 在 `StrengthAnalysisView` 中添加实时反馈

**预期收益**: 提升动作分析功能的实用性

---

### 2.4 数据导入导出增强

#### 2.4.1 多平台数据同步

**功能描述**:

- 支持导入 Strava、Garmin Connect、Apple Health 数据
- 自动同步跑步数据
- 统一数据格式

**实现要点**:

- 创建 `src/services/import/platformSync.js`
- 支持各平台 API（如 Strava API）
- 添加同步设置页面

**预期收益**: 提高数据导入便利性

---

#### 2.4.2 数据备份与恢复

**功能描述**:

- 一键导出所有数据（JSON 格式）
- 支持数据恢复
- 定期提醒备份

**实现要点**:

- 创建 `src/services/backupService.js`
- 在 Profile 页面添加备份/恢复功能
- 使用 Firebase Storage 存储备份

**预期收益**: 保护用户数据安全

---

### 2.5 移动端优化

#### 2.5.1 PWA 支持

**功能描述**:

- 将应用改造为 PWA（Progressive Web App）
- 支持离线使用
- 添加到主屏幕

**实现要点**:

- 添加 `manifest.json`
- 注册 Service Worker
- 实现离线缓存策略

**预期收益**: 提升移动端体验，增加用户使用频率

---

#### 2.5.2 响应式设计优化

**功能描述**:

- 优化移动端布局
- 改进触摸交互
- 适配小屏幕显示

**实现要点**:

- 使用 Tailwind 响应式类优化布局
- 测试各页面在移动端的显示效果
- 优化表单输入体验

**预期收益**: 提升移动端用户体验

---

## 三、实施优先级建议

### 高优先级（立即实施）

1. **统一错误处理机制** - 提升代码质量和用户体验
2. **完成 CalendarView 重构** - 移除重复代码，提高可维护性
3. **数据缓存策略** - 提升性能，减少 Firebase 读取

### 中优先级（近期实施）

4. **状态管理优化** - 简化数据流，提升开发效率
5. **训练周期分析** - 增加数据价值
6. **PR 追踪** - 提升用户动力

### 低优先级（长期规划）

7. **TypeScript 迁移** - 提升代码质量（可选）
8. **PWA 支持** - 提升移动端体验
9. **社交功能** - 增加用户粘性

---

## 四、技术债务清单

### 需要立即修复

- [ ] `CalendarView.jsx` 中的 `cleanNumber` 重复定义（第 16-20 行）
- [ ] 所有 `alert()` 调用应替换为统一错误提示
- [ ] 缺少统一的加载状态处理

### 需要中期改进

- [ ] 添加单元测试（Jest + React Testing Library）
- [ ] 添加 E2E 测试（Playwright 或 Cypress）
- [ ] 完善 README.md 文档

### 需要长期规划

- [ ] TypeScript 迁移（可选）
- [ ] 性能监控和错误追踪（Sentry）
- [ ] CI/CD 流程完善